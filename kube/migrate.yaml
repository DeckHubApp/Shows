apiVersion: batch/v1
kind: Job
metadata:
  name: shows-migrate
  namespace: slidable
spec:
  template:
    metadata:
      name: shows-migrate
    spec:
      containers:
      - name: shows-migrate
        image: slidable/shows-migrate:1.0.0-alpha1
        args: ["$(SECRET_CONNSTR)"]
        env:
          - name: SECRET_CONNSTR
            valueFrom:
              secretKeyRef:
                name: shows-db
                key: connstr
      restartPolicy: OnFailure